{"remainingRequest":"/home/jaskaran/code/jaskaran/activitywatch/aw-server-rust/aw-webui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/jaskaran/code/jaskaran/activitywatch/aw-server-rust/aw-webui/src/visualizations/CategoryTree.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server-rust/aw-webui/src/visualizations/CategoryTree.vue","mtime":1622830085274},{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server-rust/aw-webui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server-rust/aw-webui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server-rust/aw-webui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server-rust/aw-webui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server-rust/aw-webui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCAndnVlLWF3ZXNvbWUvaWNvbnMvY2lyY2xlJzsKaW1wb3J0ICd2dWUtYXdlc29tZS9pY29ucy9yZWd1bGFyL3BsdXMtc3F1YXJlJzsKaW1wb3J0ICd2dWUtYXdlc29tZS9pY29ucy9yZWd1bGFyL21pbnVzLXNxdWFyZSc7CmNvbnN0IF8gPSByZXF1aXJlKCdsb2Rhc2gnKTsKY29uc3QgY2xhc3NlcyA9IHJlcXVpcmUoJ34vdXRpbC9jbGFzc2VzLnRzJyk7CgpmdW5jdGlvbiBfZ2V0X2NoaWxkX2NhdHMoY2F0LCBhbGxfY2F0cykgewogIHJldHVybiBfLmZpbHRlcihhbGxfY2F0cywgYyA9PiBfLmlzRXF1YWwoYy5wYXJlbnQsIGNhdC5uYW1lKSk7Cn0KCmZ1bmN0aW9uIF9hc3NpZ25fY2hpbGRyZW4ocGFyZW50LCBhbGxfY2F0cykgewogIGNvbnN0IGNoaWxkX2NhdHMgPSBfZ2V0X2NoaWxkX2NhdHMocGFyZW50LCBhbGxfY2F0cyk7CiAgLy8gUmVjdXJzZQogIF8ubWFwKGNoaWxkX2NhdHMsIGMgPT4gX2Fzc2lnbl9jaGlsZHJlbihjLCBhbGxfY2F0cykpOwogIHBhcmVudC5jaGlsZHJlbiA9IF8uc29ydEJ5KGNoaWxkX2NhdHMsIGNjID0+IC1jYy5kdXJhdGlvbik7Cn0KCi8vIEZsYXR0ZW5zIHRoZSBjYXRlZ29yeSBoaWVyYXJjaHkKZnVuY3Rpb24gX2ZsYXR0ZW5faGllcmFyY2h5KGMpIHsKICBpZiAoIWMuY2hpbGRyZW4pIHJldHVybiBbXTsKICByZXR1cm4gXy5mbGF0dGVuRGVlcChbYywgXy5tYXAoYy5jaGlsZHJlbiwgY2MgPT4gX2ZsYXR0ZW5faGllcmFyY2h5KGNjKSldKTsKfQoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdhdy1jYXRlZ29yeXRyZWUnLAogIHByb3BzOiB7CiAgICBldmVudHM6IHsgdHlwZTogQXJyYXkgfSwKICB9LAogIGRhdGE6IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB7CiAgICAgIGV4cGFuZGVkOiBuZXcgU2V0KCksCiAgICAgIHNob3dfcGVyYzogZmFsc2UsCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHRvdGFsX2R1cmF0aW9uOiBmdW5jdGlvbiAoKSB7CiAgICAgIC8vIHN1bSB0b3AtbGV2ZWwgY2F0ZWdvcmllcwogICAgICBjb25zdCB0b3BfYyA9IF8uZmlsdGVyKHRoaXMuY2F0ZWdvcnlfaGllcmFyY2h5LCBjID0+IGMuZGVwdGggPT0gMCk7CiAgICAgIHJldHVybiBfLnN1bUJ5KHRvcF9jLCBjID0+IGMuZHVyYXRpb24pOwogICAgfSwKICAgIGNhdGVnb3J5X2hpZXJhcmNoeTogZnVuY3Rpb24gKCkgewogICAgICBjb25zdCBldmVudHMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuZXZlbnRzKSk7CgogICAgICBjb25zdCBoaWVyID0gY2xhc3Nlcy5idWlsZF9jYXRlZ29yeV9oaWVyYXJjaHkoCiAgICAgICAgXy5tYXAoZXZlbnRzLCBlID0+IHsKICAgICAgICAgIHJldHVybiB7IG5hbWU6IGUuZGF0YVsnJGNhdGVnb3J5J10gfTsKICAgICAgICB9KQogICAgICApOwoKICAgICAgbGV0IGNhdHMgPSBjbGFzc2VzLmZsYXR0ZW5fY2F0ZWdvcnlfaGllcmFyY2h5KGhpZXIpLm1hcChjID0+IHsKICAgICAgICBjLmR1cmF0aW9uID0gXy5zdW1CeSgKICAgICAgICAgIGV2ZW50cy5maWx0ZXIoZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHBjYXQgPSBlLmRhdGFbJyRjYXRlZ29yeSddLnNsaWNlKDAsIGMubmFtZS5sZW5ndGgpOwogICAgICAgICAgICByZXR1cm4gXy5pc0VxdWFsKGMubmFtZSwgcGNhdCk7CiAgICAgICAgICB9KSwKICAgICAgICAgIGUgPT4gZS5kdXJhdGlvbgogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGM7CiAgICAgIH0pOwoKICAgICAgY29uc3QgY2F0c193aXRoX2RlcHRoMCA9IF8uc29ydEJ5KAogICAgICAgIF8uZmlsdGVyKGNhdHMsIGMgPT4gYy5kZXB0aCA9PSAwKSwKICAgICAgICBjID0+IC1jLmR1cmF0aW9uCiAgICAgICk7CiAgICAgIF8ubWFwKGNhdHNfd2l0aF9kZXB0aDAsIGMgPT4gX2Fzc2lnbl9jaGlsZHJlbihjLCBjYXRzKSk7CgogICAgICBjYXRzID0gXy5mbGF0dGVuKF8ubWFwKGNhdHNfd2l0aF9kZXB0aDAsIGMgPT4gX2ZsYXR0ZW5faGllcmFyY2h5KGMpKSk7CiAgICAgIC8vY29uc29sZS5sb2coY2F0cyk7CiAgICAgIC8vIFRPRE86IElmIGEgY2F0ZWdvcnkgaGFzIGNoaWxkcmVuLCBidXQgYWxzbyBhY3Rpdml0eSBhdHRyaWJ1dGVkIGRpcmVjdGx5IHRvIHRoZSBwYXJlbnQgdGhhdCBkb2VzIG5vdCBiZWxvbmcgdG8gYSBjaGlsZCwgdGhlbiBjcmVhdGUgYSAiT3RoZXIiIGNoaWxkIGNvbnRhaW5pbmcgdGhlIGFjdGl2aXR5LgogICAgICByZXR1cm4gY2F0czsKICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICBnZXRfY2F0ZWdvcnk6IGZ1bmN0aW9uIChjYXRfYXJyKSB7CiAgICAgIHJldHVybiBfLmZpbmQodGhpcy5jYXRlZ29yeV9oaWVyYXJjaHksIGMgPT4gXy5pc0VxdWFsKGMubmFtZSwgY2F0X2FycikpOwogICAgfSwKICAgIHRvZ2dsZTogZnVuY3Rpb24gKGNhdCkgewogICAgICBpZiAodGhpcy5leHBhbmRlZC5oYXMoY2F0Lm5hbWVfcHJldHR5KSkgewogICAgICAgIHRoaXMuZXhwYW5kZWQuZGVsZXRlKGNhdC5uYW1lX3ByZXR0eSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5leHBhbmRlZC5hZGQoY2F0Lm5hbWVfcHJldHR5KTsKICAgICAgfQogICAgICAvLyBuZWVkZWQgdG8gdHJpZ2dlciB1cGRhdGUsIHNpbmNlIFNldCBpc24ndCByZWFjdGl2ZSBpbiBWdWUgMgogICAgICB0aGlzLmV4cGFuZGVkID0gbmV3IFNldCh0aGlzLmV4cGFuZGVkKTsKICAgIH0sCiAgICBwYXJlbnRzX2V4cGFuZGVkOiBmdW5jdGlvbiAoY2F0KSB7CiAgICAgIGlmIChjYXQgPT09IHVuZGVmaW5lZCB8fCAhY2F0LnBhcmVudCkgewogICAgICAgIC8vIHRvcC1sZXZlbCBjYXRlZ29yeQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiAoCiAgICAgICAgLy8gQ2hlY2sgZ3JhbmRwYXJlbnRzIHJlY3Vyc2l2ZWx5CiAgICAgICAgdGhpcy5wYXJlbnRzX2V4cGFuZGVkKHRoaXMuZ2V0X2NhdGVnb3J5KGNhdC5wYXJlbnQpKSAmJgogICAgICAgIC8vIENoZWNrIHBhcmVudAogICAgICAgIHRoaXMuZXhwYW5kZWQuaGFzKGNhdC5wYXJlbnQuam9pbignPicpKQogICAgICApOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["CategoryTree.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CategoryTree.vue","sourceRoot":"src/visualizations","sourcesContent":["<template lang=\"pug\">\ndiv(style=\"font-size: 0.9em\")\n  div(v-for=\"cat in category_hierarchy\", style=\"padding: 0.1em 0 0.1em 0\" @click=\"toggle(cat)\" v-if=\"parents_expanded(cat)\")\n    span(:style=\"'padding-left: ' + (1.4 * cat.depth) + 'em'\")\n\n      // icon\n      span(v-if=\"cat.children.length > 0\", style=\"opacity: 0.8\")\n        b(v-if=\"!expanded.has(cat.name_pretty)\")\n          icon.mr-1(name=\"regular/plus-square\", scale=\"0.8\")\n        b(v-else)\n          icon.mr-1(name=\"regular/minus-square\", scale=\"0.8\")\n      span(v-else, style=\"opacity: 0.6\")\n        icon(name=\"circle\", scale=\"0.4\", style=\"margin-left: 1em; margin-right: 1.22em;\")\n\n      // title\n      | {{cat.subname}}\n\n    // time\n    span(style=\"float: right\")\n      span(v-if=\"show_perc\")\n        | {{Math.round(100 * cat.duration / total_duration, 1)}}%\n      span(v-else)\n        | {{cat.duration | friendlyduration}}\n  hr\n  // TODO: Make configurable in a cleaner way (figure out a way to configure visualizations generally)\n  b-checkbox(v-model=\"show_perc\" size=\"sm\") Show percent\n</template>\n\n<script>\nimport 'vue-awesome/icons/circle';\nimport 'vue-awesome/icons/regular/plus-square';\nimport 'vue-awesome/icons/regular/minus-square';\nconst _ = require('lodash');\nconst classes = require('~/util/classes.ts');\n\nfunction _get_child_cats(cat, all_cats) {\n  return _.filter(all_cats, c => _.isEqual(c.parent, cat.name));\n}\n\nfunction _assign_children(parent, all_cats) {\n  const child_cats = _get_child_cats(parent, all_cats);\n  // Recurse\n  _.map(child_cats, c => _assign_children(c, all_cats));\n  parent.children = _.sortBy(child_cats, cc => -cc.duration);\n}\n\n// Flattens the category hierarchy\nfunction _flatten_hierarchy(c) {\n  if (!c.children) return [];\n  return _.flattenDeep([c, _.map(c.children, cc => _flatten_hierarchy(cc))]);\n}\n\nexport default {\n  name: 'aw-categorytree',\n  props: {\n    events: { type: Array },\n  },\n  data: function () {\n    return {\n      expanded: new Set(),\n      show_perc: false,\n    };\n  },\n  computed: {\n    total_duration: function () {\n      // sum top-level categories\n      const top_c = _.filter(this.category_hierarchy, c => c.depth == 0);\n      return _.sumBy(top_c, c => c.duration);\n    },\n    category_hierarchy: function () {\n      const events = JSON.parse(JSON.stringify(this.events));\n\n      const hier = classes.build_category_hierarchy(\n        _.map(events, e => {\n          return { name: e.data['$category'] };\n        })\n      );\n\n      let cats = classes.flatten_category_hierarchy(hier).map(c => {\n        c.duration = _.sumBy(\n          events.filter(e => {\n            const pcat = e.data['$category'].slice(0, c.name.length);\n            return _.isEqual(c.name, pcat);\n          }),\n          e => e.duration\n        );\n        return c;\n      });\n\n      const cats_with_depth0 = _.sortBy(\n        _.filter(cats, c => c.depth == 0),\n        c => -c.duration\n      );\n      _.map(cats_with_depth0, c => _assign_children(c, cats));\n\n      cats = _.flatten(_.map(cats_with_depth0, c => _flatten_hierarchy(c)));\n      //console.log(cats);\n      // TODO: If a category has children, but also activity attributed directly to the parent that does not belong to a child, then create a \"Other\" child containing the activity.\n      return cats;\n    },\n  },\n  methods: {\n    get_category: function (cat_arr) {\n      return _.find(this.category_hierarchy, c => _.isEqual(c.name, cat_arr));\n    },\n    toggle: function (cat) {\n      if (this.expanded.has(cat.name_pretty)) {\n        this.expanded.delete(cat.name_pretty);\n      } else {\n        this.expanded.add(cat.name_pretty);\n      }\n      // needed to trigger update, since Set isn't reactive in Vue 2\n      this.expanded = new Set(this.expanded);\n    },\n    parents_expanded: function (cat) {\n      if (cat === undefined || !cat.parent) {\n        // top-level category\n        return true;\n      }\n      return (\n        // Check grandparents recursively\n        this.parents_expanded(this.get_category(cat.parent)) &&\n        // Check parent\n        this.expanded.has(cat.parent.join('>'))\n      );\n    },\n  },\n};\n</script>\n"]}]}