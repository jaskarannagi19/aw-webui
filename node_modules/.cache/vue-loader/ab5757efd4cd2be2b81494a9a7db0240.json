{"remainingRequest":"/home/jaskaran/code/jaskaran/activitywatch/aw-server/aw-webui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/jaskaran/code/jaskaran/activitywatch/aw-server/aw-webui/src/views/Search.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server/aw-webui/src/views/Search.vue","mtime":1622212604097},{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server/aw-webui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server/aw-webui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server/aw-webui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7CmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JzsKaW1wb3J0IHsgY2Fub25pY2FsRXZlbnRzIH0gZnJvbSAnfi9xdWVyaWVzJzsKCmltcG9ydCAndnVlLWF3ZXNvbWUvaWNvbnMvc2VhcmNoJzsKaW1wb3J0ICd2dWUtYXdlc29tZS9pY29ucy9zcGlubmVyJzsKaW1wb3J0ICd2dWUtYXdlc29tZS9pY29ucy9hbmdsZS1kb3VibGUtZG93bic7CmltcG9ydCAndnVlLWF3ZXNvbWUvaWNvbnMvYW5nbGUtZG91YmxlLXVwJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnU2VhcmNoJywKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcGF0dGVybjogJycsCiAgICAgIHZpc19tZXRob2Q6ICdldmVudGxpc3QnLAogICAgICBldmVudF90eXBlOiAnY3VycmVudHdpbmRvdycsCiAgICAgIGV2ZW50czogbnVsbCwKICAgICAgZXJyb3I6ICcnLAogICAgICBzdGF0dXM6IG51bGwsCiAgICAgIGhvc3RuYW1lOiAnJywKCiAgICAgIC8vIE9wdGlvbnMKICAgICAgc2hvd19vcHRpb25zOiBmYWxzZSwKICAgICAgdXNlX3JlZ2V4OiB0cnVlLAogICAgICBmaWx0ZXJfYWZrOiB0cnVlLAogICAgICBzdGFydDogbW9tZW50KCkuc3VidHJhY3QoMSwgJ2RheScpLAogICAgICBzdG9wOiBtb21lbnQoKS5hZGQoMSwgJ2RheScpLAogICAgfTsKICB9LAogIG1vdW50ZWQ6IGFzeW5jIGZ1bmN0aW9uICgpIHsKICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdidWNrZXRzL2Vuc3VyZUJ1Y2tldHMnKTsKICAgIHRoaXMuaG9zdG5hbWUgPSBPYmplY3Qua2V5cyh0aGlzLiRzdG9yZS5nZXR0ZXJzWydidWNrZXRzL2J1Y2tldHNCeUhvc3RuYW1lJ10pWzBdOwogIH0sCiAgbWV0aG9kczogewogICAgc2VhcmNoOiBhc3luYyBmdW5jdGlvbiAoKSB7CiAgICAgIGxldCBxdWVyeSA9IGNhbm9uaWNhbEV2ZW50cyh7CiAgICAgICAgYmlkX3dpbmRvdzogJ2F3LXdhdGNoZXItd2luZG93XycgKyB0aGlzLmhvc3RuYW1lLAogICAgICAgIGJpZF9hZms6ICdhdy13YXRjaGVyLWFma18nICsgdGhpcy5ob3N0bmFtZSwKICAgICAgICBmaWx0ZXJfYWZrOiB0aGlzLmZpbHRlcl9hZmssCiAgICAgICAgY2xhc3NlczogW1tbJ3NlYXJjaGVkJ10sIHsgdHlwZTogJ3JlZ2V4JywgcmVnZXg6IHRoaXMucGF0dGVybiB9XV0sCiAgICAgICAgZmlsdGVyX2NsYXNzZXM6IFtbJ3NlYXJjaGVkJ11dLAogICAgICB9KTsKICAgICAgcXVlcnkgKz0gJzsgUkVUVVJOID0gZXZlbnRzOyc7CgogICAgICBjb25zdCBxdWVyeV9hcnJheSA9IHF1ZXJ5LnNwbGl0KCc7JykubWFwKHMgPT4gcy50cmltKCkgKyAnOycpOwogICAgICBjb25zdCB0aW1lcGVyaW9kcyA9IFt0aGlzLnN0YXJ0LmZvcm1hdCgpICsgJy8nICsgdGhpcy5zdG9wLmZvcm1hdCgpXTsKICAgICAgdHJ5IHsKICAgICAgICB0aGlzLnN0YXR1cyA9ICdzZWFyY2hpbmcnOwogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLiRhdy5xdWVyeSh0aW1lcGVyaW9kcywgcXVlcnlfYXJyYXkpOwogICAgICAgIHRoaXMuZXZlbnRzID0gXy5vcmRlckJ5KGRhdGFbMF0sIFsndGltZXN0YW1wJ10sIFsnZGVzYyddKTsKICAgICAgICB0aGlzLmVycm9yID0gJyc7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgIHRoaXMuZXJyb3IgPSBlLnJlc3BvbnNlLmRhdGEubWVzc2FnZTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0aGlzLnN0YXR1cyA9IG51bGw7CiAgICAgIH0KICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["Search.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Search.vue","sourceRoot":"src/views","sourcesContent":["<template lang=\"pug\">\ndiv\n  h3 Search\n\n  b-alert(style=\"warning\" show)\n    | This feature is still in early development.\n\n  b-alert(v-if=\"error\" show variant=\"danger\")\n    | {{error}}\n\n  b-input-group(size=\"lg\")\n    b-input(v-model=\"pattern\" v-on:keyup.enter=\"search()\" placeholder=\"Regex pattern to search for\")\n    b-input-group-append\n      b-button(type=\"button\", @click=\"search()\" variant=\"success\")\n        icon(name=\"search\")\n        | Search\n\n  div.d-flex.mt-1\n    span.mr-auto.small(style=\"color: #666\") Hostname: {{hostname}}\n    b-button(size=\"sm\", variant=\"outline-dark\" style=\"border: 0\" @click=\"show_options = !show_options\")\n      span(v-if=\"!show_options\")\n        | #[icon(name=\"angle-double-down\")] Show options\n      span(v-else)\n        | #[icon(name=\"angle-double-up\")] Hide options\n\n  div(v-if=\"show_options\")\n    h4 Options\n    div Hostname\n      select(v-model=\"hostname\")\n        option(v-for=\"hostname in Object.keys($store.getters['buckets/bucketsByHostname'])\")\n          | {{hostname}}\n    div Start: {{start.format()}}\n    div End: {{stop.format()}}\n    //div\n      label Use regex\n      input(type=\"checkbox\" v-model=\"use_regex\")\n    div\n      label Filter AFK\n      input(type=\"checkbox\" v-model=\"filter_afk\")\n    //div.form-row\n      div.form-group.col-md-6\n        | Start\n        input.form-control(type=\"date\", :max=\"today\", v-model=\"startdate\")\n      div.form-group.col-md-6\n        | End\n        input.form-control(type=\"date\", :max=\"tomorrow\", v-model=\"enddate\")\n\n    div.form-inline\n\n  div(v-if=\"status == 'searching'\")\n    div #[icon(name=\"spinner\" pulse)] Searching...\n\n  div(v-if=\"events != null\")\n    hr\n\n    aw-selectable-eventview(:events=\"events\")\n\n    div\n      | Didn't find what you were looking for?\n      br\n      | Add a week to the search: #[b-button(size=\"sm\" variant=\"outline-dark\" @click=\"start = start.subtract(1, 'week'); search()\") +1 week]\n\n</template>\n\n<style scoped lang=\"scss\"></style>\n\n<script>\nimport _ from 'lodash';\nimport moment from 'moment';\nimport { canonicalEvents } from '~/queries';\n\nimport 'vue-awesome/icons/search';\nimport 'vue-awesome/icons/spinner';\nimport 'vue-awesome/icons/angle-double-down';\nimport 'vue-awesome/icons/angle-double-up';\n\nexport default {\n  name: 'Search',\n  data() {\n    return {\n      pattern: '',\n      vis_method: 'eventlist',\n      event_type: 'currentwindow',\n      events: null,\n      error: '',\n      status: null,\n      hostname: '',\n\n      // Options\n      show_options: false,\n      use_regex: true,\n      filter_afk: true,\n      start: moment().subtract(1, 'day'),\n      stop: moment().add(1, 'day'),\n    };\n  },\n  mounted: async function () {\n    await this.$store.dispatch('buckets/ensureBuckets');\n    this.hostname = Object.keys(this.$store.getters['buckets/bucketsByHostname'])[0];\n  },\n  methods: {\n    search: async function () {\n      let query = canonicalEvents({\n        bid_window: 'aw-watcher-window_' + this.hostname,\n        bid_afk: 'aw-watcher-afk_' + this.hostname,\n        filter_afk: this.filter_afk,\n        classes: [[['searched'], { type: 'regex', regex: this.pattern }]],\n        filter_classes: [['searched']],\n      });\n      query += '; RETURN = events;';\n\n      const query_array = query.split(';').map(s => s.trim() + ';');\n      const timeperiods = [this.start.format() + '/' + this.stop.format()];\n      try {\n        this.status = 'searching';\n        const data = await this.$aw.query(timeperiods, query_array);\n        this.events = _.orderBy(data[0], ['timestamp'], ['desc']);\n        this.error = '';\n      } catch (e) {\n        console.error(e);\n        this.error = e.response.data.message;\n      } finally {\n        this.status = null;\n      }\n    },\n  },\n};\n</script>\n"]}]}