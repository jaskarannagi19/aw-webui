{"remainingRequest":"/home/jaskaran/code/jaskaran/activitywatch/aw-server/aw-webui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/jaskaran/code/jaskaran/activitywatch/aw-server/aw-webui/src/visualizations/Calendar.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server/aw-webui/src/visualizations/Calendar.vue","mtime":1622212604097},{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server/aw-webui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server/aw-webui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server/aw-webui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server/aw-webui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/jaskaran/code/jaskaran/activitywatch/aw-server/aw-webui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldFRpdGxlQXR0ciwgZ2V0Q29sb3JGcm9tU3RyaW5nIH0gZnJvbSAnLi4vdXRpbC9jb2xvcic7CmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JzsKaW1wb3J0IF8gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IEZ1bGxDYWxlbmRhciBmcm9tICdAZnVsbGNhbGVuZGFyL3Z1ZSc7CmltcG9ydCB0aW1lR3JpZFBsdWdpbiBmcm9tICdAZnVsbGNhbGVuZGFyL3RpbWVncmlkJzsKCi8vIFRPRE86IFVzZSBjYW5vbmljYWwgdGltZWxpbmUgcXVlcnksIHdpdGggZmxvb2RpbmcgYW5kIGNhdGVnb3JpemF0aW9uCi8vIFRPRE86IENoZWNrYm94IGZvciB0b2dnbGluZyBjYXRlZ29yeS12aWV3LCB3aGVyZSBhZGphY2VudCBldmVudHMgd2l0aCBzYW1lIGNhdGVnb3J5IGFyZSBtZXJnZWQgYW5kIHRoZSBldmVudHMgYXJlIGxhYmVsZWQgYnkgY2F0ZWdvcnkKLy8gVE9ETzogVXNlIHRoZSByZWNvbW1lbmRlZCB3YXkgb2YgZHluYW1pY2FsbHkgZ2V0dGluZyBldmVudHM6IGh0dHBzOi8vZnVsbGNhbGVuZGFyLmlvL2RvY3MvZXZlbnRzLWZ1bmN0aW9uCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBGdWxsQ2FsZW5kYXIsIC8vIG1ha2UgdGhlIDxGdWxsQ2FsZW5kYXI+IHRhZyBhdmFpbGFibGUKICB9LAogIHByb3BzOiB7CiAgICBidWNrZXRzOiB7IHR5cGU6IEFycmF5IH0sCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsgZml0VG9BY3RpdmU6IGZhbHNlLCBzZWxlY3RlZEJ1Y2tldDogbnVsbCwgdmlldzogJ3RpbWVHcmlkRGF5JyB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGNhbGVuZGFyT3B0aW9uczogZnVuY3Rpb24gKCkgewogICAgICBjb25zdCBldmVudHMgPSB0aGlzLmV2ZW50czsKICAgICAgY29uc3QgZmlyc3QgPSBfLm1pbkJ5KGV2ZW50cywgZSA9PiBlLnN0YXJ0KTsKICAgICAgY29uc3QgbGFzdCA9IF8ubWF4QnkoZXZlbnRzLCBlID0+IGUuZW5kKTsKICAgICAgLy8gRklYTUU6IGVuZCBtdXN0IGJlIGF0IGxlYXN0IG9uZSBzbG90ICgxIGhvdXIpIGFmdGVyIHN0YXJ0LCBvdGhlcndpc2UgaXQgZmFpbHMgaGFyZAogICAgICBsZXQgc3RhcnQsIGVuZDsKICAgICAgaWYgKHRoaXMuZml0VG9BY3RpdmUgJiYgZXZlbnRzLmxlbmd0aCA+IDApIHsKICAgICAgICBjb25zb2xlLmxvZyhmaXJzdC5zdGFydCk7CiAgICAgICAgc3RhcnQgPSBtb21lbnQoZmlyc3Quc3RhcnQpLnN0YXJ0T2YoJ2hvdXInKS5mb3JtYXQoKS5zbGljZSgxMSwgMTYpOwogICAgICAgIGVuZCA9IG1vbWVudChsYXN0LmVuZCkuZW5kT2YoJ2hvdXInKS5mb3JtYXQoKS5zbGljZSgxMSwgMTYpOwogICAgICB9IGVsc2UgewogICAgICAgIHN0YXJ0ID0gJzAwOjAwOjAwJzsKICAgICAgICBlbmQgPSAnMjQ6MDA6MDAnOwogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgcGx1Z2luczogW3RpbWVHcmlkUGx1Z2luXSwKICAgICAgICBpbml0aWFsVmlldzogdGhpcy52aWV3LAogICAgICAgIGV2ZW50Q2xpY2s6IHRoaXMub25FdmVudENsaWNrLAogICAgICAgIGV2ZW50czogZXZlbnRzLAogICAgICAgIGFsbERheVNsb3Q6IGZhbHNlLAogICAgICAgIHNsb3RNaW5UaW1lOiBzdGFydCwKICAgICAgICBzbG90TWF4VGltZTogZW5kLAogICAgICAgIG5vd0luZGljYXRvcjogdHJ1ZSwKICAgICAgICBleHBhbmRSb3dzOiB0cnVlLAogICAgICAgIHNsb3RMYWJlbEZvcm1hdDogewogICAgICAgICAgaG91cjogJzItZGlnaXQnLAogICAgICAgICAgbWludXRlOiAnMi1kaWdpdCcsCiAgICAgICAgICAvL3NlY29uZDogJzItZGlnaXQnLAogICAgICAgICAgaG91cjEyOiBmYWxzZSwKICAgICAgICB9LAogICAgICB9OwogICAgfSwKICAgIGV2ZW50czogZnVuY3Rpb24gKCkgewogICAgICAvLyBOT1RFOiBUaGlzIHJldHVybnMgRnVsbENhbGVuZGFyIGV2ZW50cywgbm90IEFjdGl2aXR5V2F0Y2ggZXZlbnRzLgogICAgICBpZiAodGhpcy5idWNrZXRzID09IG51bGwpIHJldHVybiBbXTsKCiAgICAgIGNvbnN0IGJ1Y2tldCA9IF8uZmluZCh0aGlzLmJ1Y2tldHMsIGIgPT4gYi5pZCA9PSB0aGlzLnNlbGVjdGVkQnVja2V0KTsKICAgICAgaWYgKGJ1Y2tldCA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxldCBldmVudHMgPSBidWNrZXQuZXZlbnRzOwogICAgICBldmVudHMgPSBfLmZpbHRlcihldmVudHMsIGUgPT4gZS5kdXJhdGlvbiA+IDEwKTsKICAgICAgZXZlbnRzID0gXy5tYXAoZXZlbnRzLCBlID0+IHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdGl0bGU6IGdldFRpdGxlQXR0cihidWNrZXQsIGUpLAogICAgICAgICAgc3RhcnQ6IG1vbWVudChlLnRpbWVzdGFtcCkuZm9ybWF0KCksCiAgICAgICAgICBlbmQ6IG1vbWVudChlLnRpbWVzdGFtcCkuYWRkKGUuZHVyYXRpb24sICdzZWNvbmRzJykuZm9ybWF0KCksCiAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGdldENvbG9yRnJvbVN0cmluZyhnZXRUaXRsZUF0dHIoYnVja2V0LCBlKSksCiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIHJldHVybiBldmVudHM7CiAgICB9LAogIH0sCiAgd2F0Y2g6IHsKICAgIHZpZXc6IGZ1bmN0aW9uICh0bykgewogICAgICBjb25zdCBjYWxlbmRhciA9IHRoaXMuJHJlZnMuZnVsbENhbGVuZGFyLmdldEFwaSgpOwogICAgICBjYWxlbmRhci5jaGFuZ2VWaWV3KHRvKTsKICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICBvbkV2ZW50Q2xpY2s6IGZ1bmN0aW9uIChhcmcpIHsKICAgICAgLy8gVE9ETzogT3BlbiBldmVudCBpbnNwZWN0b3IvZWRpdG9yIGhlcmUKICAgICAgYWxlcnQoJ2V2ZW50IGNsaWNrISAnICsgSlNPTi5zdHJpbmdpZnkoYXJnLmV2ZW50KSk7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["Calendar.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAiBA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Calendar.vue","sourceRoot":"src/visualizations","sourcesContent":["<template lang=\"pug\">\ndiv.mx-3\n  b-form\n    b-form-group(label=\"Bucket:\")\n      select(v-model=\"selectedBucket\")\n        option(v-for=\"bucket in buckets\", :value=\"bucket.id\") {{ bucket.id }}\n    b-form-group(label=\"Show:\")\n      select(v-model=\"view\")\n        option(value=\"timeGridDay\") Day\n        option(value=\"timeGridWeek\") Week\n    b-form-group\n      b-checkbox(v-model=\"fitToActive\")\n        | Fit to active\n  FullCalendar(ref=\"fullCalendar\", :options=\"calendarOptions\")\n</template>\n\n<script>\nimport { getTitleAttr, getColorFromString } from '../util/color';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport FullCalendar from '@fullcalendar/vue';\nimport timeGridPlugin from '@fullcalendar/timegrid';\n\n// TODO: Use canonical timeline query, with flooding and categorization\n// TODO: Checkbox for toggling category-view, where adjacent events with same category are merged and the events are labeled by category\n// TODO: Use the recommended way of dynamically getting events: https://fullcalendar.io/docs/events-function\nexport default {\n  components: {\n    FullCalendar, // make the <FullCalendar> tag available\n  },\n  props: {\n    buckets: { type: Array },\n  },\n  data() {\n    return { fitToActive: false, selectedBucket: null, view: 'timeGridDay' };\n  },\n  computed: {\n    calendarOptions: function () {\n      const events = this.events;\n      const first = _.minBy(events, e => e.start);\n      const last = _.maxBy(events, e => e.end);\n      // FIXME: end must be at least one slot (1 hour) after start, otherwise it fails hard\n      let start, end;\n      if (this.fitToActive && events.length > 0) {\n        console.log(first.start);\n        start = moment(first.start).startOf('hour').format().slice(11, 16);\n        end = moment(last.end).endOf('hour').format().slice(11, 16);\n      } else {\n        start = '00:00:00';\n        end = '24:00:00';\n      }\n      return {\n        plugins: [timeGridPlugin],\n        initialView: this.view,\n        eventClick: this.onEventClick,\n        events: events,\n        allDaySlot: false,\n        slotMinTime: start,\n        slotMaxTime: end,\n        nowIndicator: true,\n        expandRows: true,\n        slotLabelFormat: {\n          hour: '2-digit',\n          minute: '2-digit',\n          //second: '2-digit',\n          hour12: false,\n        },\n      };\n    },\n    events: function () {\n      // NOTE: This returns FullCalendar events, not ActivityWatch events.\n      if (this.buckets == null) return [];\n\n      const bucket = _.find(this.buckets, b => b.id == this.selectedBucket);\n      if (bucket == null) {\n        return;\n      }\n      let events = bucket.events;\n      events = _.filter(events, e => e.duration > 10);\n      events = _.map(events, e => {\n        return {\n          title: getTitleAttr(bucket, e),\n          start: moment(e.timestamp).format(),\n          end: moment(e.timestamp).add(e.duration, 'seconds').format(),\n          backgroundColor: getColorFromString(getTitleAttr(bucket, e)),\n        };\n      });\n      return events;\n    },\n  },\n  watch: {\n    view: function (to) {\n      const calendar = this.$refs.fullCalendar.getApi();\n      calendar.changeView(to);\n    },\n  },\n  methods: {\n    onEventClick: function (arg) {\n      // TODO: Open event inspector/editor here\n      alert('event click! ' + JSON.stringify(arg.event));\n    },\n  },\n};\n</script>\n"]}]}